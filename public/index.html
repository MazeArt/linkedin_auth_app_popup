<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Homepage</title>
    <style>
      #spinner-div {
      position: fixed;
      display: none;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      text-align: center;
      background-color: rgba(255, 255, 255, 0.8);
      z-index: 2;
    }
    </style>

  </head>
  <body>
    <a id="oauth-linkedin-popup">Authenticate via Linkedin (popup)</a>

   <div id="spinner-div" class="pt-5">
  <div class="spinner-border text-primary" role="status">
  </div>
</div>
<div class="container">
  <div class="row mt-2">
    <div class="col-12">
      <div class="card shadow">
        <div class="card-body">
          <h3 class="text-center text-primary">Ajax spinner whilst loading</h3>
          <div class="row">
            <div class="col-6">
              <button type="button" class="btn btn-success my-2" id="do-call">Load the message</button>
            </div>
            <div class="col-6 mt-2">
              <p id="message_string">The message is:</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
    
   
    <script>
      const CLIENT_ID = "78m81c58vzpvwe";
      const URI =  "http://localhost:3000/oauth/linkedin/login/callback"

      const url = new URL("https://www.linkedin.com/oauth/v2/authorization?response_type=code&state=foobar&scope=r_liteprofile%20r_emailaddress%20w_member_social");
     
      url.searchParams.set("client_id", CLIENT_ID);
      url.searchParams.set("redirect_uri", URI);

      const popupA = document.getElementById("oauth-linkedin-popup");
      popupA.setAttribute("href", url);
      popupA.addEventListener("click", (event) => {
        event.preventDefault();

        const features = {
          popup: "yes",
          width: 600,
          height: 700,
          top: "auto",
          left: "auto",
          toolbar: "no",
          menubar: "no",
        };

        const strWindowsFeatures = Object.entries(features)
          .reduce((str, [key, value]) => {
            if (value == "auto") {
              if (key === "top") {
                const v = Math.round(
                  window.innerHeight / 2 - features.height / 2
                );
                str += `top=${v},`;
              } else if (key === "left") {
                const v = Math.round(
                  window.innerWidth / 2 - features.width / 2
                );
                str += `left=${v},`;
              }
              return str;
            }

            str += `${key}=${value},`;
            return str;
          }, "")
          .slice(0, -1);

        window.open(url, "_blank", strWindowsFeatures);
      });

      window.addEventListener("message", receiveMessage, false);

      function receiveMessage(event) {
        if (event.origin !== window.location.origin) {
          console.warn(`Message received by ${event.origin}; IGNORED.`);
          return;
        }

        const access_token = event.data;

        console.log(access_token); // save this in storage, cookie and use it with GitHub REST API
      }
    </script>
  </body>
</html>
